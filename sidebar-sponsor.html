<script>
(function() {
  function addSponsorBox() {
    // Check if already added
    if (document.querySelector('.sidebar-sponsor-box')) return;
    
    // Find the sidebar container
    const sidebar = document.querySelector('.sidebar') || 
                    document.querySelector('#quarto-sidebar') ||
                    document.querySelector('[role="complementary"]');
    
    if (!sidebar) {
      console.log('Sidebar not found');
      return;
    }
    
    // Try to find search input or form
    const searchInput = sidebar.querySelector('input[type="search"]') ||
                       sidebar.querySelector('input[type="text"]') ||
                       sidebar.querySelector('#quarto-search') ||
                       sidebar.querySelector('.quarto-search');
    
    // Helper function to create SVG elements
    function createSVGElement(tag, attrs) {
      const elem = document.createElementNS('http://www.w3.org/2000/svg', tag);
      for (const key in attrs) {
        elem.setAttribute(key, attrs[key]);
      }
      return elem;
    }
    
    // Create Buy Me a Coffee SVG
    function createBuyMeACoffeeIcon() {
      const svg = createSVGElement('svg', {
        width: '24',
        height: '24',
        viewBox: '0 0 24 24',
        role: 'img',
        class: 'sponsor-icon'
      });
      const path = createSVGElement('path', {
        d: 'm20.216 6.415-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 0 0-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 0 0-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 0 1-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 0 1 3.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 0 1-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 0 1-4.743.295 37.059 37.059 0 0 1-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0 0 11.343.376.483.483 0 0 1 .535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 0 1 .39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 0 1-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884 0 0 1-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38 0 0 1.243.065 1.658.065.447 0 1.786-.065 1.786-.065.783 0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996 0 0 0-1.322-.238c-.826 0-1.491.284-2.26.613z',
        fill: 'currentColor'
      });
      svg.appendChild(path);
      return svg;
    }
    
    // Create Ko-fi SVG
    function createKofiIcon() {
      const svg = createSVGElement('svg', {
        width: '24',
        height: '24',
        viewBox: '0 0 90 90',
        role: 'img',
        class: 'sponsor-icon'
      });
      const circlePath = createSVGElement('path', {
        d: 'M 45 90 L 45 90 C 20.147 90 0 69.853 0 45 v 0 C 0 20.147 20.147 0 45 0 h 0 c 24.853 0 45 20.147 45 45 v 0 C 90 69.853 69.853 90 45 90 z',
        fill: '#333333'
      });
      const kPath = createSVGElement('path', {
        d: 'M 63.672 24.897 c -4.418 -0.387 -7.053 -0.542 -19.613 -0.542 c -8.449 0 -14.495 0.078 -19.068 0.775 c -6.433 0.931 -8.993 4.573 -8.993 11.084 H 16 c 0 10 0.62 16.433 3.876 22.402 c 3.72 6.9 10.464 9.535 18.139 9.535 h 2.402 c 10.078 0 14.962 -4.884 17.675 -9.147 c 1.318 -2.171 2.48 -4.573 3.1 -7.597 l 0.465 -1.938 h 2.791 c 6.202 0 11.55 -5.037 11.55 -11.473 v -1.162 C 75.998 29.625 71.503 25.825 63.672 24.897 z M 49.643 53.617 c -2.093 2.094 -5.502 4.264 -7.829 5.66 c -0.622 0.387 -1.396 0.62 -2.326 0.62 c -0.776 0 -1.473 -0.233 -2.171 -0.62 c -2.324 -1.395 -5.735 -3.566 -7.906 -5.66 c -3.255 -3.102 -5.813 -7.055 -5.813 -11.628 h -0.002 c 0 -4.962 3.567 -9.38 8.993 -9.38 c 3.18 0 5.426 1.627 6.9 3.875 c 1.629 -2.247 3.8 -3.875 6.977 -3.875 c 5.349 0 9.069 4.418 9.069 9.38 C 55.534 46.564 52.977 50.517 49.643 53.617 z M 63.597 44.084 c -1.24 0 -1.938 -0.698 -1.938 -1.629 v -8.758 c 0 -0.931 0.698 -1.629 1.938 -1.629 c 3.953 0 6.124 2.327 6.124 6.046 C 69.721 41.835 67.55 44.084 63.597 44.084 z',
        fill: '#f8f9fa'
      });
      svg.appendChild(circlePath);
      svg.appendChild(kPath);
      return svg;
    }
    
    // Build the sponsor box structure
    const sponsorBox = document.createElement('div');
    sponsorBox.className = 'sidebar-sponsor-box';
    
    const sponsorContent = document.createElement('div');
    sponsorContent.className = 'sponsor-content';
    
    const sponsorHeader = document.createElement('span');
    sponsorHeader.className = 'sponsor-header';
    sponsorHeader.textContent = 'Sponsor me:';
    
    const sponsorLinks = document.createElement('div');
    sponsorLinks.className = 'sponsor-links';
    
    // Buy Me a Coffee link
    const bmcLink = document.createElement('a');
    bmcLink.href = 'https://buymeacoffee.com/mikaelbrunila';
    bmcLink.target = '_blank';
    bmcLink.rel = 'noopener';
    bmcLink.className = 'sponsor-link';
    bmcLink.title = 'Buy Me a Coffee';
    bmcLink.appendChild(createBuyMeACoffeeIcon());
    
    // Ko-fi link
    const kofiLink = document.createElement('a');
    kofiLink.href = 'https://ko-fi.com/mikaelbrunila';
    kofiLink.target = '_blank';
    kofiLink.rel = 'noopener';
    kofiLink.className = 'sponsor-link';
    kofiLink.title = 'Ko-fi';
    kofiLink.appendChild(createKofiIcon());
    
    // GitHub Sponsors link
    const ghLink = document.createElement('a');
    ghLink.href = 'https://github.com/sponsors/maybemkl';
    ghLink.target = '_blank';
    ghLink.rel = 'noopener';
    ghLink.className = 'sponsor-link';
    ghLink.title = 'GitHub Sponsors';
    const ghIcon = document.createElement('i');
    ghIcon.className = 'bi bi-github';
    ghLink.appendChild(ghIcon);
    
    // PayPal link
    const paypalLink = document.createElement('a');
    paypalLink.href = 'https://www.paypal.com/donate/?business=LEDZ3LJSRSRUN&no_recurring=0&item_name=I+create+tutorials+for+information+theory+and+geospatial+data+science%21&currency_code=EUR';
    paypalLink.target = '_blank';
    paypalLink.rel = 'noopener';
    paypalLink.className = 'sponsor-link';
    paypalLink.title = 'PayPal';
    const paypalIcon = document.createElement('i');
    paypalIcon.className = 'bi bi-paypal';
    paypalLink.appendChild(paypalIcon);
    
    // Assemble the structure
    sponsorLinks.appendChild(bmcLink);
    sponsorLinks.appendChild(kofiLink);
    sponsorLinks.appendChild(ghLink);
    sponsorLinks.appendChild(paypalLink);
    
    sponsorContent.appendChild(sponsorHeader);
    sponsorContent.appendChild(sponsorLinks);
    sponsorBox.appendChild(sponsorContent);
    
    // If we found a search input, insert after its parent form/div
    if (searchInput) {
      const searchContainer = searchInput.closest('form') || 
                              searchInput.closest('div') || 
                              searchInput.parentElement;
      if (searchContainer && searchContainer.nextSibling) {
        searchContainer.parentElement.insertBefore(sponsorBox, searchContainer.nextSibling);
      } else if (searchContainer) {
        searchContainer.parentElement.appendChild(sponsorBox);
      } else {
        sidebar.insertBefore(sponsorBox, sidebar.firstChild);
      }
    } else {
      // If no search found, insert at the beginning of sidebar (before TOC)
      const toc = sidebar.querySelector('nav[role="doc-toc"]');
      if (toc) {
        sidebar.insertBefore(sponsorBox, toc);
      } else {
        sidebar.insertBefore(sponsorBox, sidebar.firstChild);
      }
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', addSponsorBox);
  } else {
    addSponsorBox();
  }
  
  // Also try after delays in case content loads dynamically
  setTimeout(addSponsorBox, 500);
  setTimeout(addSponsorBox, 1000);
  setTimeout(addSponsorBox, 2000);
})();
</script>

<style>
.sidebar-sponsor-box {
  margin-top: 0.5rem;
  padding: 0.25rem;
  background: #f8f9fa;
  border: 0.5px solid #dee2e6;
  border-radius: 0.375rem;
  font-size: 0.75rem;
}

.sponsor-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.1rem;
}

.sponsor-header {
  color: #343a40;
  font-size: 0.85rem;
  font-weight: 300;
  white-space: nowrap;
}

.sponsor-links {
  display: flex;
  flex-direction: row;
  gap: 0.2rem;
  align-items: center;
}

.sponsor-link {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #2761e3;
  text-decoration: none;
  padding: 0.25rem;
  border-radius: 0.25rem;
  transition: background-color 0.15s ease, transform 0.15s ease;
  font-size: 1rem;
  width: 1.5rem;
  height: 1.5rem;
}

.sponsor-link:hover {
  background-color: #e9ecef;
  color: #1f4eb6;
  text-decoration: none;
  transform: scale(1.1);
}

.sponsor-link .bi {
  font-size: 1.1rem;
}

.sponsor-icon {
  width: 1.1rem;
  height: 1.1rem;
  display: block;
  object-fit: contain;
}
</style>
